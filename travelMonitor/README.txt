Αγγελική Παναγοπούλου - 1115201800141
Προγραμματισμός Συστήματος - 2η εργασία - Εαρινό Εξάμηνο 2021

********************************
  Οργάνωση Φακέλων και Αρχείων
********************************

> monitor
    > relations
    > tools
    monitor_main.c
> mylib
    > BloomFilter
    > Date
    > HashTable
    > IPC
    > LinkedList
    > SkipList
> src
    > relations
    > tools
    - main.c
> inputDir
- create_infiles.sh
- inputFile
- Makefile

*****************************
  Μεταγλώττιση και Εκτέλεση
*****************************

Δημιουργία του φακέλου input_dir:
./create_infiles.sh inputFile input_dir numFilesPerDirectory
Το αρχείο inputFile πρέπει να βρίσκεται στον κεντρικό φάκελο, όπως δείχνει η αναπαράσταση 
"Οργάνωση Φακέλων και Αρχείων".

Πρόγραμμα:
Στον κεντρικό φάκελο που βρίσκεται το Makefile, η μεταγλώττιση γίνεται με την εντολή make.
Τα object files αποθηκεύονται στον φάκελο build που δημιουργείται.
Το εκτελέσιμο παράγεται στον κεντρικό φάκελο και τρέχει με την εντολή:
./travelMonitor –m numMonitors -b bufferSize -s sizeOfBloom -i input_dir

*****************************
  Υλοποίηση Δομών Δεδομένων
*****************************

Τα LinkedList, SkipList, HashTable, Date, BloomFilter είναι τα ίδια που έχουν χρησιμοποιηθεί στην 
1η εργασία ΣυσΠρο.

> mylib > IPC > ipc.h/.c
Περιέχει τις συναρτήσεις για Inter-Process Communication μεταξύ των διεργασιών πατέρα - παιδί μέσω των 
named pipes. Έχει γίνει η παραδοχή ότι το πρώτο μήνυμα που θα σταλθεί ή ληφθεί είναι το μέγεθος των 
δεδομένων. Αναλυτικά σχόλια στον κώδικα.

***********************
  Σχέσεις - relations
***********************

> src > relations >  virus_bloom.h/.c
Η δομή που συγκρατά το όνομα του ιού, δείκτη σε BloomFilter για τον ιό και λίστες accepted_requests/rejected_requests
που αποτελούνται από τις ημερομηνίες για τις οποίες έγιναν αιτήματα ταξιδιού και έγιναν δεκτές ή απορρίφθηκαν αντίστοιχα.
Αναλυτικά σχόλια στον κώδικα.

> src > relations > monitor.h/.c
Η δομή μιας διεργασίας - παιδί - monitor που συγκρατά το PID, το index για τους πίνακες που διατηρούν τα 
file descriptors των διεργασιών για read και write, μια λίστα με τις χώρες που διαχειρίζεται το monitor, 
ένα HashTable από virus_bloom structs και τους μετρητές για total_accepted/total_rejected αιτήματα.
Αναλυτικά σχόλια στον κώδικα.

> monitor > relations > country.h/.c
Η δομή της χώρας που συγκρατά το όνομα της χώρας.

> monitor > relations > citizenRecord.h/.c
Η δομή του πολίτη. Συγκρατά citizenID, firstname, lastname, age και τη χώρα που είναι δείκτης στη δομή country!
Αναλυτικά σχόλια στον κώδικα.

> monitor > relations > virus.h/.c
Υπάρχουν δύο δομές.
Δομή vaccinated: Συγκρατά δείκτη στην δομή του πολίτη citizen και δείκτη στην ημερομηνία date.
Δομή virus: Συγκρατά το όνομα του ιού, δείκτη σε SkipList για τους vaccinated_persons του ιού, 
δείκτη σε SkipList για τους not_vaccinated_persons του ιού και δείκτη σε BloomFilter.
Αναλυτικά σχόλια στον κώδικα.

********************
  Εργαλεία - Tools
********************

> src > tools > utils.h/.c 
Οι κύριες συναρτήσεις:

    -aggregator:
    Αποτελεί τον κύριο κορμό της εφαρμογής. Δημιουργεί τις διεργασίες - παιδιά - monitors.
    Δημιουργεί τα named pipes τα οποία έχει επιλεγεί να είναι δύο για κάθε διεργασία - παιδί:
    Το ένα θα είναι για να γράφει ο πατέρας και να διαβάζει το παιδί και το άλλο θα είναι για να γράφει το παιδί
    και να διαβάζει ο πατέρας. Διατηρεί τους πίνακες read_fd και write_fd που περιέχουν τα file descriptors 
    των named pipes για διάβασμα και γράψιμο αντίστοιχα με κάθε διεργασία - παιδί. Διατηρεί τον πίνακα 
    monitors_pids που περιέχει τα PIDs των διεργασιών - παιδιών. Συγκρατά ένα HashTable από monitor structs
    με κλειδί τα PIDs των διεργασιών. Κατανέμει τους φακέλους με τις χώρες σε κάθε monitor με RR alphabetically
    τρόπο. Καλεί την συνάρτηση run_queries για την εκτέλεση των εντολών χρήστη. Μόλις σημανθεί /exit ή δοθεί
    σήμα SIGINT/SIGQUIT στη διεργασία - γονέα, ο γονέας κάνει SIGKILL τα παιδιά του, περιμένει να τερματίσουν
    και δημιουργεί τα log files. Αναλυτικά σχόλια στον κώδικα.

    -get_bloom_filters:
    Η διαδικασία που η διεργασία - γονέα λαμβάνει τα bloom filters που στείλανε οι διεργασίες - παιδιά του.
    Αναλυτικά σχόλια στον κώδικα.

    -reborn_child:
    Η διαδικασία αναγέννησης και αντικατάστασης μιας διεργασίας - παιδί που έχει τερματίσει.
    Αναλυτικά σχόλια στον κώδικα.

> src > tools > queries.h/.c
    -run_queries:
    Εκτελεί τα ερωτήματα και καλεί βοηθητικές συναρτήσεις που έχουν υλοποιηθεί στο queries.c .
    Εκεί γίνεται και η διαχείριση των σημάτων SIGINT/SIGQUIT και SIGCHLD.
    Αναλυτικά σχόλια στον κώδικα.   

> monitor > tools > dataStore.h/.c
Δομή dataStore: Συγκρατά τα 3 Hash Tables του monitor:
1) Για τους ιούς: Δέχεται τη δομή virus κι έχει κλειδί το όνομα του ιού (String)
2) Για τις χώρες: Δέχεται τη δομή country κι έχει κλειδί το όνομα της χώρας (String)
3) Για τους πολίτες: Δέχεται τη δομή citizenRecord κι έχει κλεδί το citizenID (Integer)
Κατά τη δημιουργία, τίθενται και οι συναρτήσεις καταστροφής destroy_virus, destroy_country, destroy_citizen.

> monitor > tools > utils_queries.h/.c
Οι κύριες συναρτήσεις:

    -fileParse_and_buildStructs: 
    Κάνει το file parsing και ταυτόχρονα "χτίζει" όλες τις δομές. Καλεί την συνάρτηση insertCitizen.
    Αναλυτικά σχόλια στον κώδικα.

    -send_bloomFilters
    Στέλνει τα bloom filters μέσω named pipe πίσω στην διεργασία πατέρα.

    -queries
    Εκτελεί τα ερωτήματα και καλεί βοηθητικές συναρτήσεις που έχουν υλοποιηθεί στο utils_queries.c .
    Εκεί γίνεται και η διαχείριση των σημάτων SIGINT/SIGQUIT και SIGUSR.
    Αναλυτικά σχόλια στον κώδικα.

****************************
  Επισημάνσεις - Παραδοχές
****************************

- Ο φάκελος inputDir είναι ένας έτοιμος που έχει δημιουργηθεί από το create_infiles.sh .